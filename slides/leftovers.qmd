---
title: "Unused Slides from Other Chapters"
engine: knitr
---

# One-offs

## How can I quickly translate API docs?

-   Docs often have "Try it out" option
    -   [https://api.open.fec.gov/developers/](https://api.open.fec.gov/developers/)
-   Copy the "Curl" block

::: fragment
```{r}
curl_translate(
  "curl -X 'GET' \
  'https://api.open.fec.gov/v1/candidates/?api_key=DEMO_KEY&office=H'"
)
```
:::

::: fragment
```
request("https://api.open.fec.gov/v1/candidates/") |> 
  req_method("GET") |> 
  req_url_query(
    api_key = "DEMO_KEY",
    office = "H"
  ) |> 
  req_perform()
```
:::

::: notes
-   If you want to use this API, sign up for your own key at that same URL.
-   I edited the given curl to fit
-   This code will usually get you started
-   Now let's clean it up and understand it!
-   Extra: OpenAPI 3.0 description at https://api.apis.guru/v2/specs/fec.gov/1.0/openapi.json
:::

## The Pieces of a URL

https://api.open.fec.gov/v1/candidates/?election_year=2020&office=P&api_key=DEMO_KEY

-   `https://api.open.fec.gov` = "scheme" + "host name"
-   `/v1/candidates/` = "path"
-   `?election_year=2020&office=P&api_key=DEMO_KEY` = "query"
-   *Not present:* 
    -   `:1234` = "port"
    -   `#target` = "fragment"
    -   `username:password@`

# tibblify::parse_openapi_spec()

## Endpoint info as data

-   {tibblify} can load OpenAPI endpoint data

```{r}
#| label: httr2-openfec-endpoints-download
#| eval: false
#| include: false
openfec_endpoints <- tibblify::parse_openapi_spec("https://api.apis.guru/v2/specs/fec.gov/1.0/openapi.json")
saveRDS(
  openfec_endpoints, 
  here::here("slides", "httr2", "httr2", "openfec_endponts.rds")
)
```
```{r}
#| label: httr2-openfec-endpoints-load
#| eval: true
#| include: false
openfec_endpoints <- readRDS(
  here::here("slides", "httr2", "httr2", "openfec_endponts.rds")
)
```

::: fragment
```{r}
#| label: httr2-openfec-endpoints-display
openfec_endpoints <- tibblify::parse_openapi_spec("https://api.apis.guru/v2/specs/fec.gov/1.0/openapi.json")
openfec_endpoints |> 
  unnest(operations)
```
```{r}
#| label: httr2-openfec-endpoints-print
#| eval: true
#| echo: false
openfec_endpoints |> 
  tidyr::unnest(operations) |> dplyr::select(
    endpoint, parameters, responses, description, tags, operation, dplyr::everything()
  )
```
:::

::: notes
-   This is a dev version of tibblify, production version only gets some of this data.
:::

## Endpoint parameters

```{r}
#| eval: true
candidates_endpoint <- openfec_endpoints |> 
  unnest(operations) |> 
  filter(endpoint == "/candidates/")
candidates_endpoint |> 
  select(parameters) |> 
  unnest(parameters)
```

## Endpoint responses

```{r}
#| eval: true
candidates_endpoint |> 
  select(responses) |>
  unnest(responses) |> 
  unnest(content)
```

::: notes
-   Note that `spec` is a tspec!
:::
